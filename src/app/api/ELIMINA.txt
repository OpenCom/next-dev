// ATTENZIONE: Da qui si pu√≤ fare tutto...


import { NextResponse } from "next/server";
import pool from '@/lib/db';

export async function GET(request) {

  const searchParams = request.nextUrl.searchParams;
  const q = searchParams.get('q') // query is "hello" for /api/search?query=hello

  if (!q) {
    return NextResponse.json({ error: 'No query provided' }, {status: 400}); //, params ? JSON.parse(params) : []
  }

  let conn;
  try {
    conn = await pool.getConnection();
    const [rows] = await conn.query(q);
    return NextResponse.json(rows, {status: 200});
  } catch (err) {
    if (err instanceof Error) {
      return NextResponse.json({error: 'Database query failed', details: err.message} , {status: 500});
    }
  }
}